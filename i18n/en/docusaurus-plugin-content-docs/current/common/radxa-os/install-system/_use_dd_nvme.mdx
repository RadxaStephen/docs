import { Image } from "@site/src/utils/docs";

This document explains how to install the system to an NVMe SSD using the `dd` command.

:::warning
Installing the system will format the NVMe SSD. Please back up important data in advance!
:::

## Prerequisites

You need to meet the following conditions to install the system to an NVMe SSD using the `dd` command:

- The system can boot normally from another storage device: It is recommended to boot the system from a MicroSD card

- NVMe SSD is installed on the board

## Hardware Connection

You can proceed according to your board's configuration.

:::tip
This tutorial is applicable to multiple boards. You need to select the corresponding steps for hardware connection based on your board's configuration.

There are two scenarios for installing an NVMe SSD on a board:

- Board with M.2 M Key interface: NVMe SSD can be installed directly

- Board without M.2 M Key interface but with PCIe FPC interface: NVMe SSD can be installed using a PCIe to M.2 M Key HAT module

  :::

<Tabs queryString="system boot">
  <TabItem value="M.2 M 2280 Interface" default={props.tag === "m2_2280"} attributes={{ className: props.tag !== "m2_2280" ? "tab_none" : "" }}>
    Install NVMe SSD through M.2 M Key 2280 interface.
    <div style={{ textAlign: "center" }}>
      <img
        src="/en/img/common/radxa-os/install-system/nvme-m2-2280.webp"
        style={{ width: "100%", maxWidth: "1200px" }}
      />
    </div>
  </TabItem>

<TabItem
  value="M.2 M 2230 Interface"
  default={props.tag === "m2_2230"}
  attributes={{ className: props.tag !== "m2_2230" ? "tab_none" : "" }}
>
  Install NVMe SSD through M.2 M Key 2230 interface.
  <Image
    src="/en/img/common/radxa-os/install-system/radxa-#board#-nvme-ssd.webp"
    board={props.board}
    fallback={props.board}
    width="300"
  />
</TabItem>

  <TabItem value="PCIe FPC Interface" default={props.tag === "pcie_fpc"} attributes={{className: props.tag !== "pcie_fpc" ? "tab_none" : ""}}>
    NVMe SSD can be installed using the PCIe FPC interface with an M.2 M Key HAT.
  </TabItem>
</Tabs>

## Install the System

### Download the System Image

On the board, visit the [Resources Download](../../../../download) page and download the system image file locally.

:::tip Image Note
The downloaded system image is a compressed file. You need to extract it before use!
:::

You can use the `wget` command to download the system image file to the board.

<NewCodeBlock tip={`radxa@${props?.board ?? 'device'}$`} type="device">

```
sudo apt update
sudo apt install wget -y
wget <download_url>
```

</NewCodeBlock>

Here, `<download_url>` is the download address of the system image file. You can copy the image download link from the [Resources Download](../../../../download) page and replace it.

Download example: <code>{`wget ${props?.download_url ?? '<download_url>'}`}</code>

#### Extract the System Image

Our system images are usually in the `*.img.xz` format and must be extracted before use.

<NewCodeBlock tip={`radxa@${props?.board ?? 'device'}$`} type="device">

```
sudo apt install xz-utils -y
unxz <path_to_image_unxz>
```

</NewCodeBlock>

Here, `<path_to_image_unxz>` is the path to the system image file. Replace it with the actual path.

Extraction example:

<code>{`unxz ${props?.path_to_image_unxz ?? "<path_to_image_unxz>"}`}</code>

### Identify the Device Path

You can use the `lsblk` command to view device paths and determine the correct one based on disk capacity.

Note: If the disk capacities are very similar, you can safely hot-plug (applies to NVMe SSD) to observe which device path appears and disappears to determine the correct device path.

<NewCodeBlock tip={`radxa@${props?.board ?? 'device'}$`} type="device">

```
lsblk
```

</NewCodeBlock>

If the system recognizes an SPI Flash device, it is usually shown as a `/dev/mtdblock*` device.

If the system recognizes an NVMe device, it is usually shown as a `/dev/nvme*n*` device. If there are multiple NVMe devices, you can determine the corresponding device path by safely hot-plugging.

Example terminal output:

```
NAME        MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS
mtdblock0    31:0    0    16M  0 disk
mmcblk0     179:0    0    58G  0 disk
├─mmcblk0p1 179:1    0    16M  0 part /config
├─mmcblk0p2 179:2    0   300M  0 part /boot/efi
└─mmcblk0p3 179:3    0  57.6G  0 part /
zram0       254:0    0 982.6M  0 disk [SWAP]
nvme0n1     259:0    0 119.2G  0 disk
```

### Install the System Image

Use the `dd` command to write the system image to the NVMe SSD.

<NewCodeBlock tip={`radxa@${props?.board ?? 'device'}$`} type="device">

```
sudo dd if=<path_to_image> of=<device_target> bs=4M status=progress
```

</NewCodeBlock>

Write example:

<code>{`sudo dd if=${
  props?.path_to_image ?? "<path_to_image>"
} of=/dev/nvme0n1 bs=4M status=progress`}</code>

Parameter description:

- `<path_to_image>`: The path to the system image file. Replace it with the actual path.

- `<device_target>`: The device path of the NVMe SSD module. Replace it with the actual NVMe SSD device path.

- `bs=4M`: Block size for writing.

- `status=progress`: Show write progress.

### Verify the Write Result

After installation, use the `lsblk` command to check whether the partition table on the NVMe SSD has been created correctly.

<NewCodeBlock tip={`radxa@${props?.board ?? 'device'}$`} type="device">

```
lsblk
```

</NewCodeBlock>

Example terminal output:

```
NAME        MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
mtdblock0    31:0    0    16M  0 disk
mmcblk0     179:0    0    58G  0 disk
├─mmcblk0p1 179:1    0    16M  0 part /config
├─mmcblk0p2 179:2    0   300M  0 part /boot/efi
└─mmcblk0p3 179:3    0  57.6G  0 part /
zram0       254:0    0 982.6M  0 disk [SWAP]
nvme0n1     259:0    0 238.5G  0 disk
├─nvme0n1p1 259:1    0    16M  0 part
├─nvme0n1p2 259:2    0   300M  0 part
└─nvme0n1p3 259:3    0 238.2G  0 part
```
